<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line ç†Šå¤§è¾²å ´ç”¢å“æ¯”ä¾‹æ›ç®—å™¨</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f5f5f5;
            position: relative;
        }

        /* æµ®æ°´å°å®¹å™¨ */
        .watermark-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        /* æµ®æ°´å°æ¨£å¼ */
        .watermark {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
        }

        .watermark-row {
            width: 200%;
            display: flex;
            justify-content: space-around;
        }

        .watermark-text {
            font-size: 24px;
            color: rgba(0, 0, 0, 0.08);
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .watermark-text {
                font-size: 32px;
            }
        }

        .container {
            width: 90%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .instruction-box {
            background-color: #f8f9fa;
            border-left: 4px solid #4a90e2;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 15px;
            line-height: 1.5;
            color: #555;
        }

        .calculator {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .product-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        select,
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.3);
        }

        .separator {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }

        .separator hr {
            flex-grow: 1;
            border: none;
            height: 1px;
            background-color: #ddd;
        }

        .separator span {
            margin: 0 15px;
            color: #777;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #777;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 30px;
            font-style: italic;
            color: #777;
        }

        @media (max-width: 480px) {
            .container {
                width: 95%;
                padding: 10px;
            }

            h1 {
                font-size: 24px;
            }

            .instruction-box {
                padding: 12px;
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <!-- æµ®æ°´å°å®¹å™¨ -->
    <div class="watermark-container">
        <div class="watermark">
            <div class="watermark-row">
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
            </div>
            <div class="watermark-row">
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
            </div>
            <div class="watermark-row">
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
            </div>
            <div class="watermark-row">
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
            </div>
            <div class="watermark-row">
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
                <span class="watermark-text">ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤</span>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>Line ç†Šå¤§è¾²å ´ç”¢å“æ¯”ä¾‹æ›ç®—å™¨</h1>

        <div class="instruction-box">
            æ¯”ä¾‹çš†ç‚ºåƒè€ƒï¼Œå¯ä»¥è‡ªè¡Œèª¿æ•´ï¼Œå»ºè­°ä»¥åŒé–“å•†åº—è£½ä½œçš„å•†å“äº¤æ›ã€‚
        </div>

        <div class="calculator">
            <div id="loading" class="loading">
                æ­£åœ¨è¼‰å…¥ç”¢å“è³‡æ–™ï¼Œè«‹ç¨å€™...
            </div>

            <div id="calculator-content" style="display: none;">
                <div class="product-group">
                    <label for="store1">åº—å®¶ 1:</label>
                    <select id="store1"></select>

                    <label for="product1">ç”¢å“ 1:</label>
                    <select id="product1"></select>

                    <label for="value1">æ•¸é‡:</label>
                    <input type="number" id="value1" step="any" min="0" placeholder="è«‹è¼¸å…¥æ•¸é‡">
                </div>

                <div class="separator">
                    <hr><span>æ¯”ä¾‹æ›ç®—</span>
                    <hr>
                </div>

                <div class="product-group">
                    <label for="store2">åº—å®¶ 2:</label>
                    <select id="store2"></select>

                    <label for="product2">ç”¢å“ 2:</label>
                    <select id="product2"></select>

                    <label for="value2">æ•¸é‡:</label>
                    <input type="number" id="value2" step="any" min="0" placeholder="è«‹è¼¸å…¥æ•¸é‡">
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>Â© Line ç†Šå¤§è¾²å ´ç”¢å“æ¯”ä¾‹æ›ç®—å™¨ | ğŸŒ³ç†Šå¤§è¾²å ´ğŸ–¤ç¥ä¹‹ç¦åœ°ğŸ¤è£½ä½œ</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Googleè¡¨æ ¼CSVé€£çµ
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTGcoHbq7kfXRlFEZCTDyTRW6YLsbUzt6oA8ii8IcE4BwVV66rmckeImgbslwpzjLTo1y6gNcopmqTK/pub?gid=0&single=true&output=csv';

            // è³‡æ–™å„²å­˜
            let rawData = [];
            let stores = [];
            let productsByStore = {};

            // ç²å–DOMå…ƒç´ 
            const store1Select = document.getElementById('store1');
            const store2Select = document.getElementById('store2');
            const product1Select = document.getElementById('product1');
            const product2Select = document.getElementById('product2');
            const value1Input = document.getElementById('value1');
            const value2Input = document.getElementById('value2');
            const loadingDiv = document.getElementById('loading');
            const calculatorContent = document.getElementById('calculator-content');

            // å¾CSVç²å–ç”¢å“è³‡æ–™
            fetch(csvUrl)
                .then(response => response.text())
                .then(data => {
                    // è§£æCSVè³‡æ–™
                    const rows = data.split('\n');

                    // è·³éæ¨™é¡Œè¡Œï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                    for (let i = 1; i < rows.length; i++) {
                        const columns = rows[i].split(',');

                        // ç¢ºä¿è³‡æ–™æ ¼å¼æ­£ç¢º
                        if (columns.length >= 3) {
                            const storeName = columns[0].trim();
                            const productName = columns[1].trim();
                            const ratio = parseFloat(columns[2].trim());

                            // ç¢ºä¿è³‡æ–™æœ‰æ•ˆ
                            if (storeName && productName && !isNaN(ratio)) {
                                rawData.push({
                                    store: storeName,
                                    product: productName,
                                    ratio: ratio
                                });

                                // æ”¶é›†ä¸é‡è¤‡çš„åº—å
                                if (!stores.includes(storeName)) {
                                    stores.push(storeName);
                                }

                                // æŒ‰åº—åçµ„ç¹”ç”¢å“
                                if (!productsByStore[storeName]) {
                                    productsByStore[storeName] = [];
                                }

                                // é¿å…é‡è¤‡æ·»åŠ ç”¢å“
                                if (!productsByStore[storeName].some(p => p.name === productName)) {
                                    productsByStore[storeName].push({
                                        name: productName,
                                        ratio: ratio
                                    });
                                }
                            }
                        }
                    }

                    // å¡«å……åº—åä¸‹æ‹‰é¸å–®
                    populateStoreDropdowns();

                    // åˆå§‹åŒ–ç”¢å“ä¸‹æ‹‰é¸å–®
                    updateProductDropdowns();

                    // éš±è—è¼‰å…¥ç•«é¢ï¼Œé¡¯ç¤ºè¨ˆç®—å™¨
                    loadingDiv.style.display = 'none';
                    calculatorContent.style.display = 'block';
                })
                .catch(error => {
                    console.error('ç²å–è³‡æ–™å¤±æ•—:', error);
                    loadingDiv.innerHTML = 'è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢æˆ–ç¨å¾Œå†è©¦ã€‚';
                });

            // å¡«å……åº—åä¸‹æ‹‰é¸å–®
            function populateStoreDropdowns() {
                stores.forEach(store => {
                    const option1 = document.createElement('option');
                    option1.value = store;
                    option1.textContent = store;

                    const option2 = document.createElement('option');
                    option2.value = store;
                    option2.textContent = store;

                    store1Select.appendChild(option1);
                    store2Select.appendChild(option2);
                });

                // é è¨­é¸æ“‡ä¸åŒçš„åº—å®¶ï¼ˆå¦‚æœæœ‰å…©å€‹æˆ–æ›´å¤šï¼‰
                if (stores.length >= 2) {
                    store2Select.selectedIndex = 1;
                }

                // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
                initEventListeners();
            }

            // æ›´æ–°ç”¢å“ä¸‹æ‹‰é¸å–®
            function updateProductDropdowns() {
                updateProductDropdown(store1Select.value, product1Select);
                updateProductDropdown(store2Select.value, product2Select);
            }

            // æ ¹æ“šé¸æ“‡çš„åº—åæ›´æ–°ç”¢å“ä¸‹æ‹‰é¸å–®
            function updateProductDropdown(storeName, productSelect) {
                // æ¸…ç©ºç¾æœ‰é¸é …
                productSelect.innerHTML = '';

                // æ·»åŠ æ–°é¸é …
                if (productsByStore[storeName]) {
                    productsByStore[storeName].forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.name;
                        option.textContent = `${product.name}`;
                        productSelect.appendChild(option);
                    });
                }

                // å¦‚æœæœ‰ç”¢å“é¸æ“‡ï¼Œè§¸ç™¼è¨ˆç®—
                if (value1Input.value) {
                    calculateValue2();
                } else if (value2Input.value) {
                    calculateValue1();
                }
            }

            // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
            function initEventListeners() {
                // ç›£è½åº—å®¶é¸æ“‡çš„è®ŠåŒ–
                store1Select.addEventListener('change', function () {
                    updateProductDropdown(store1Select.value, product1Select);
                });

                store2Select.addEventListener('change', function () {
                    updateProductDropdown(store2Select.value, product2Select);
                });

                // ç›£è½ç”¢å“é¸æ“‡çš„è®ŠåŒ–
                product1Select.addEventListener('change', function () {
                    if (value1Input.value) {
                        calculateValue2();
                    } else if (value2Input.value) {
                        calculateValue1();
                    }
                });

                product2Select.addEventListener('change', function () {
                    if (value1Input.value) {
                        calculateValue2();
                    } else if (value2Input.value) {
                        calculateValue1();
                    }
                });

                // ç›£è½è¼¸å…¥æ¡†çš„è®ŠåŒ–
                value1Input.addEventListener('input', function () {
                    if (value1Input.value) {
                        calculateValue2();
                    }
                });

                value2Input.addEventListener('input', function () {
                    if (value2Input.value) {
                        calculateValue1();
                    }
                });
            }

            // ç²å–ç”¢å“æ¯”ä¾‹
            function getProductRatio(storeName, productName) {
                if (productsByStore[storeName]) {
                    const product = productsByStore[storeName].find(p => p.name === productName);
                    return product ? product.ratio : null;
                }
                return null;
            }

            // è¨ˆç®—ç¬¬äºŒå€‹ç”¢å“çš„å€¼
            function calculateValue2() {
                const store1Name = store1Select.value;
                const product1Name = product1Select.value;
                const store2Name = store2Select.value;
                const product2Name = product2Select.value;

                const ratio1 = getProductRatio(store1Name, product1Name);
                const ratio2 = getProductRatio(store2Name, product2Name);

                if (ratio1 && ratio2) {
                    const value1 = parseFloat(value1Input.value);

                    if (!isNaN(value1)) {
                        // æ ¹æ“šæ¯”ä¾‹è¨ˆç®—ç¬¬äºŒå€‹ç”¢å“çš„å€¼
                        const value2 = (value1 / ratio1) * ratio2;
                        value2Input.value = value2.toFixed(2);
                    }
                }
            }

            // è¨ˆç®—ç¬¬ä¸€å€‹ç”¢å“çš„å€¼
            function calculateValue1() {
                const store1Name = store1Select.value;
                const product1Name = product1Select.value;
                const store2Name = store2Select.value;
                const product2Name = product2Select.value;

                const ratio1 = getProductRatio(store1Name, product1Name);
                const ratio2 = getProductRatio(store2Name, product2Name);

                if (ratio1 && ratio2) {
                    const value2 = parseFloat(value2Input.value);

                    if (!isNaN(value2)) {
                        // æ ¹æ“šæ¯”ä¾‹è¨ˆç®—ç¬¬ä¸€å€‹ç”¢å“çš„å€¼
                        const value1 = (value2 / ratio2) * ratio1;
                        value1Input.value = value1.toFixed(2);
                    }
                }
            }
        });
    </script>
</body>

</html>